{% extends 'def_i/base.html' %}
{% load static %}
{% load sass_tags %}
{% block extra_style %}
    <link rel="stylesheet" href="{% sass_src 'def_i/css/index.scss' %}">
{% endblock %}

{% block menubar %}
{% endblock menubar %}
{% block contents %}
{% comment %} <h2>ユーザーのランキング</h2>
{% for rank in ranking %}
    {% ifchanged rank.cleared_lesson_num rank.note_num %}
        <p>{{forloop.counter}}位：{{rank}}: cleared {{rank.cleared_lesson_num}} lesson(s)
        , wrote {{rank.note_num}} note(s)
        </p>
    {% else %}
        <p>(同率）{{rank}}: cleared {{rank.cleared_lesson_num}} lesson(s), wrote {{rank.note_num}}</p>
    {% endifchanged %}
{% endfor %} {% endcomment %}

{% if studying %}
<h1 class="index_title">学習中のコース</h1>
<div class="main-container__contents-studying">
<img src="{{studying.category.category_image.url}}">
<div class="main-container__contents-studying-info">
    <h2>{{studying.category}}</h2>
    <p>進捗率</p>
    <p>学習中コース</p>
</div>

<p class="btn1"><a href="">続きからはじめる</a></p>
</div>
{% else %}
{% endif %}

<div>
<h1 class="index_title">学習中のコースに関連した質問</h1>
<div class="main-container__contents-article-container">
    <div id="questions" class="main-container__contents-article-box">
        {% for q in question %}
        <article class="main-container__contents-article questions">
            <a href="{% url 'question_detail' q.pk %}">
                <h2>{{q.title}}</h2>
            </a>
            <div class="main-container__contents-article-data">
                {{q.category.title}} レッスン{{q.course.course_num}}-{{q.lesson.lesson_num}}
                <a href="{% url 'user_page' q.poster.pk %}" class="user-disp"><img src="{{q.poster.user_image.url}}">
                    <p>{{q.poster}}</p>
                </a>
                <p class="post-date">{{q.created_at|date:"Y/n/j H:i:s"}}に投稿</p>
            </div>
            <a href="{% url 'question_detail' q.pk %}">
            </a>
        </article>
        {% empty %}
        <p>質問がありません．</p>
        {% endfor %}
    </div>
    <div class="main-container__contents-article-btn">
        <p class="btn1"><a href="{% url 'question_feed' %}">質問一覧を見る</a></p>
        <p class="btn2"><a href="{% url 'question_post' %}">質問する</a></p>
    </div>
</div>
<div class="pagination">
    {% if question.has_previous %}
    <p class="pagination_box"><a
            href="?q_page={{ question.previous_page_number }}&keyword={{request.GET.keyword}}&orderby={{request.GET.orderby}}">&lt;</a>
    </p>
    {% endif %}
    <!-- 数字の部分 -->
    {% if question.number > 3 %}
    <p class="pagination_num pagination_not_here"><a href="?q_page=1&keyword={{request.GET.keyword}}&orderby={{request.GET.orderby}}">1</a></p>
    {% endif %}

    {% if question.number > 4 %}
    <p class="pagination_num pagination_not_here"><span>...</span></p>
    {% endif %}

    {% for num in question.paginator.page_range %}
    {% if question.number == num %}
    <p class="pagination_num pagination_here"><span>{{ num }}</span></p>
    {% elif num < question.number|add:3 and num > question.number|add:-3 %}
    <p class="pagination_num pagination_not_here"><a
        href="?q_page={{ num }}&keyword={{request.GET.keyword}}&orderby={{request.GET.orderby}}">{{ num }}</a></p>
    {% endif %}
    {% endfor %}

    {% if question.number < question.paginator.num_pages|add:-3 %}
        <p class="pagination_num pagination_not_here"><span>...</span></p>
    {% endif %}
    {% if question.number < question.paginator.num_pages|add:-2 %}
    <p class="pagination_num pagination_not_here"><a
        href="?q_page={{ question.paginator.num_pages }}&keyword={{request.GET.keyword}}&orderby={{request.GET.orderby}}">{{ question.paginator.num_pages }}</a></p>
    {% endif %}
    <!-- 次へ の部分 -->
    {% if question.has_next %}
    <p class="pagination_box"><a
            href="?q_page={{ question.next_page_number }}&keyword={{request.GET.keyword}}&orderby={{request.GET.orderby}}">&gt;</a>
    </p>
    {% endif %}
</div>
</div>

<h1 class="index_title">学習中のコースに関連したノート</h1>
<div class="main-container__contents-article-container">
    <div id="new-articles" class="main-container__contents-article-box">
    {% for a in article %}
        <article class="main-container__contents-article">
            <a href="{% url 'article_detail' a.pk %}">
                <h2>{{a.title}}</h2>
            </a>
            <div class="main-container__contents-article-data">
                {{a.category.title}} レッスン{{a.course.course_num}}-{{a.lesson.lesson_num}}
                <a href="{% url 'user_page' a.poster.pk %}" class="user-disp"><img src="{{a.poster.user_image.url}}">
                    <p>{{a.poster}}</p>
                </a>
                <p class="post-date">{{a.created_at|date:"Y/n/j H:i:s"}}に投稿</p>
            </div>
        </article>
    {% empty %}
        <p>ノートがありません．</p>
    {% endfor %}
    </div>
        <div class="main-container__contents-article-btn">
        <p class="btn1"><a href="{% url 'article_feed' %}">ノート一覧を見る</a></p>
        <p class="btn2"><a href="{% url 'article_post' %}">ノートを書く</a></p>
    </div>
</div>
</div>
{% comment %}
<h2>進捗が近いユーザー</h2>
<div>
    <h3>ユーザー</h3>
    {% for colleague in colleagues %}
        <a href="{% url 'user_page' colleague.pk %}">{{colleague}}</a>
    {% endfor %}
    <p>ユーザーの進捗</p>
</div> {% endcomment %}
<div>
<h1 class="index_title">コース一覧</h1>
    {% comment %} <p>完了率：{{all_progress|floatformat}}%</p> {% endcomment %}
    <div class="indexbox-container">
    {% for cat,prog in each_progress %}
    <div class="indexbox-container-box">
        <h1>{{cat.title}}</h1>
        <img src="{{cat.category_image.url}}" alt="">
        <div class="progress_bar">{{prog}}</div>
        <p>{{category.description}}</p>
        <p class="btn3"><a href="{% url 'course_list' cat.title %}">{{cat.title}}編をはじめる</a></p>
        <p class="btn4">学習中にする</p>
    </div>
    {% endfor %}
    </div>
    </p>
    {% comment %} {% if not learning_lesson %}
        <p>全てのレッスンを完了しました。</p>
    {% else %}
        <p>勉強するレッスン：<a href="{% url 'task_detail' learning_lesson.pk %}">{{learning_lesson}}</a></p>
    {% endif %}

    <a href="{% url 'course' %}">
        <p>講座一覧へ</p>
    </a>
</div>

<a href="{% url 'message_notification' %}">
    <h2>お知らせ</h2>
</a>
{% for like in new_likes %}
    <p>{{like.user}}さんが「{{like.article.title}}」にいいねしました。</p>
{% endfor %}

{% for bookmark in new_bookmarks %}
    <p>{{bookmark.user}}さんが「{{bookmark.question.title}}」をブックマークしました。</p>
{% endfor %}

{% for comment in article_talk %}
    <p>{{comment.msg_from}}さんが「{{comment.msg_at.title}}」にコメントしました。</p>
{% endfor %}

{% for comment in question_talk %}
    <p>{{comment.msg_from}}さんが「{{comment.msg_at.title}}」にコメントしました。</p>
{% endfor %}
{% endcomment %}
{% endblock contents %}
